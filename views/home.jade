extends layout
block nav-content
  li
    a#blck(href='home')
      |  Home
  li
    a#blck(href='createProject')
      |  Create Project
  li
     a#blck(href='#')
      |  Account
  li
     button#blck.dropbtn(onclick='dropdown()')
      |  &#x2630
     #myDropdown.dropdown-content 
            a(href='settings') Settings
            br
            a(href='#about') Logout
            br
     script.

head
  title #{title}
  
  link(rel='stylesheet', href='https://fonts.googleapis.com/icon?family=Material+Icons')
style.

      main {margin:0;}
      
      body{
        background: #333;
        font-family: 'Open Sans', sans-serif;
      }
      
      table, th, td {
        border: 5px solid black;
        border-collapse: collapse;
      }
head
  title #{title}
  
  link(rel='stylesheet', href='https://fonts.googleapis.com/icon?family=Material+Icons')
style.
      main {margin:0;}
      
      body{
        background: #333;
        font-family: 'Open Sans', sans-serif;
      }
      
      table, th, td {
        border: 5px solid black;
        border-collapse: collapse;
      }
block content
  .main.container
    div.home_page_body
      body
        div#search_bar
          .wrap
            .search
              input.searchTerm(type='text', placeholder='Search Projects By Tags', size='35', name='pTags')
              button.searchButton(type='submit' onclick='saveTags()') &#x1F50D
        section#homePage_feed
          div#main_feed
            h1(align="center") Projects
            | Sort by: 
            select#sortMenu
             option(value='popular') Popular
             |     
             option(value='relevant') Relevant
             |  
             option(value='abc') Alphabetical
             |     
             option(value='recent') Recent
            table#main_table
            div(style='overflow:scroll;height:500px;width:100%;overflow:auto;')
              table#main_table
          div#main_sidebar 
           h1 Sidebar 
           p  more stuff will go here 
      //here we define the functions for the search bar, the sorting menu, and the buttons. Also programatically populate the feed with project posts from the database.
    
    script.
        //if user clicks interestsBtn
        
        function likeBtn() {
          //update user intersts in firebase table 
          //change the color 
          
           var property = document.getElementById("interestBtn");
          if (liked == false) {
              liked=true;        
              console.log("color should be changin");
          }
          else {
              like=false;
               console.log("color should go bck to normal");
          }
        var projects = Object();
        function returnProjects(){
          database = firebase.database();
          var ref = database.ref('Projects');
          ref.on('value', gotData, errData);
          console.log("Got into proj function");
          return true;
        }
        
        function gotData(data){
          console.log("Going to read data now hehe");
          
          console.log(data.val());
          projects = data.val();
          // Object.keys(projects).forEach(function(key){
          // console.log(key, projects[key]);
          // });
          
          console.log("Finished traversing");
          return projects;
        }
        
        function errData(err){
        console.log('Error!');
        window.alert(err);
        }
        
        returnProjects();
        function saveTags(){
          // if the user has not signed in or the cookie for some reason has become erased, redirect the user back to the login page
          var allcookies = document.cookie;
          //console.log("All Cookies : " + allcookies );
          cookiearray = allcookies.split(';');
          for(var i=0; i<cookiearray.length; i++){
            name = cookiearray[i].split('=')[0];
            value = cookiearray[i].split('=')[1];
            //console.log("Key is : " + name + " and Value is : " + value);
          }
          if(name == "" || name == undefined){
            return false;
            //redirect to login.jade, then return false
          }
          if(!tableIsEmpty()){
            return false;
          }
          
          // If the user doesn't enter anything into the field and clicks the search button, don't search!
          var emptyField = document.getElementsByName("pTags")[0].value;
          if(emptyField == null || emptyField == ""){
            return false;
          }
    
        //if user clicks on join button 
        function join(){
          
        }
        
        function saveTags(){
          var tags = document.getElementsByName("pTags")[0].value.split(' ');
          // have to access db to pull project info based on tag matches from array
          returnProjects();
          // Object.keys(projects).forEach(function(key){
          //   console.log(key, projects[key]);
          // });
          // var list = [
          //   { title: 'Project Oxford', description: 'Lorem ipsum dolor sit amet, essent iracundia consectetuer sed te. Iisque lucilius accommodare qui cu, mel tollit timeam perfecto in. Sit in lorem oblique, eu nihil consetetur ius, civibus ocurreret eum in. No his esse consetetur, ex has splendide scribentur.'},
          //   { title: 'Project Yale', description: 'Elitr utamur eam ne, ea mea repudiare similique. Sit cibo lobortis comprehensam ne. Possit mollis accusata ex pro, vim ei porro velit. Mea vivendo vivendum mandamus ex, nam ferri facer ut, ei mel causae sadipscing. Eum id nusquam mediocrem, error dolorem mediocrem qui ea.'},
          //   { title: 'Project Biotech', description: 'Id doming epicurei per, ius ei illum dicat postea, laboramus adolescens definitiones ea has. Vim duis augue scribentur eu, vim id natum conclusionemque. Per error primis maluisset at, utinam adversarium nam ea. Eam hinc habeo alienum te, in duo rebum postea putent. Et vivendum sapientem mei, erant adipisci in sit, habeo saepe sadipscing eu mei. Eum ei velit indoctum complectitur.'}
          // ];
          
          for(y in projects){
            for(x in projects[y]){
              addRow(projects[y][x]);
            }
          }
        }
        
        function tableIsEmpty() {
          return (/^(\s|&nbsp;)*$/.test(document.getElementById("main_table").innerHTML));
        }
          
        function addRow(x){
          console.log(x);
          var table = document.getElementById("main_table");
          
          var rowCount = table.rows.length;
          var row = table.insertRow(rowCount);
          
          var data = document.createElement("td");
          
          // todo: load database title into this variable
          var postTitle = x.project_name;
          var strong = document.createElement("strong");
          var sample = document.createTextNode("Sample Post");
          strong.appendChild(sample);
          data.appendChild(strong);
          
          // todo: load database description into this variable
          var dbDesc = x.project_description;
          var para = document.createElement("p");
          var description = document.createTextNode("Project Description");
          para.appendChild(description);
          data.appendChild(para);
          
          var add = document.createElement("button");
          add.innerHTML = "Add to Interests";
          add.addEventListener ("click", function() {
            // add the tags to users collection of interests in the db
            document.getElementById("sidebarT").innerHTML = "Project Owners:";
            document.getElementById("sidebarP").innerHTML = x.project_owner;
            document.getElementById("sidebarP").setAttribute('style', 'max-width:200px; word-wrap:break-word');
            // alert(sample.nodeValue);
          });
          data.appendChild(add);
          
          var join = document.createElement("button");
          join.innerHTML = "Join Project";
          join.addEventListener ("click", function() {
            // add user name to project collection of collaborators
            alert("Hello World!");
          });
          data.appendChild(join);
          row.appendChild(data);
          
          table.appendChild(row);
        }
        function returnProjects(tags){
          
        }
