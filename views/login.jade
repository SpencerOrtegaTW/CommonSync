extends layout
block nav-content
  li
    a#blck(href='/signup')
      span.glyphicon.glyphicon-user
      |  Sign Up
  li
    a#blck(href='/')
      span.glyphicon.glyphicon-exit
      |  Cancel
  
block content

  .main.container(style="margin-top: 5%")
    .row
      .col-md-6.col-md-offset-3
        h1.display-4.m-b-2 Log In
        form(target ="_blank" name="myForm")
          div.email
            label(for='email') Email
            input.form-control(type='text' id='email' placeholder='email' name='email' required)
          div.password
            label(for='password') Password
            input.form-control(type='password' id='password' placeholder='password' name='password' required)
          button.btn.btn-primary(type='submit' onclick="checkform();") Log in 

  script.
    function checkform(){
      var password = document.getElementById('password').value;
      var email = document.getElementById('email').value;
      
      var inputs = document.getElementsByTagName("input");

      accessDB(password, email);
    }
    
    function accessDB(password, email){
    
      database = firebase.database();
      var ref = database.ref('Users');
      ref.on('value', gotData, errData);
      return true;
    }
    
    function gotData(data){
      var email = document.getElementById('email').value;
      console.log(data.val());
      var users = data.val();
      var keys = Object.keys(users);
      console.log(keys);
      for(var i=0; i< keys.length; i++){
        var k = keys[i];
        var username = users[k].username;
        var useremail = users[k].email;
     
        if(useremail==email){
          console.log(" found it");
          //console.log(useremail, username);
          WriteCookie();
          ReadCookie();
          return true;
          //to do: refernce another page after login in 
        }
      }
      return false;
      alert("The user email and or password was entered incorretly!");
    }
    
    function errData(err){
      console.log('Error!');
      window.alert(err);
    }
    
    function WriteCookie(){
      var email = document.getElementById('email').value;
      var password = document.getElementById('password').value;
      console.log(email, password);
      if( email == ""  || password == ""){
          alert("Enter some value!");
          return;
      }
      cookievalue= escape(email) + ";";
      document.cookie="email=" + cookievalue;
      console.log("Setting Email : " + "email=" + cookievalue );
      
      cookievalueP= escape(password) + ";";
      document.cookie="password=" + cookievalueP;
      console.log("Setting Password : " + "password=" + cookievalueP );
      
    }
    
    function ReadCookie(){
      var allcookies = document.cookie;
      console.log("All Cookies : " + allcookies );
      cookiearray = allcookies.split(';');
      for(var i=0; i<cookiearray.length; i++){
        name = cookiearray[i].split('=')[0];
        value = cookiearray[i].split('=')[1];
        console.log("Key is : " + name + " and Value is : " + value);
      }
    }
